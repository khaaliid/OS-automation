# Generated by Anaconda 39.32.6
# Generated by pykickstart v3.48
#version=DEVEL
# Use graphical install
#graphical
cmdline

%post --erroronfail

rm -f /etc/ostree/remotes.d/fedora-iot.conf
ostree remote add --set=gpg-verify=true --set=gpgkeypath=/etc/pki/rpm-gpg/ --set=contenturl=mirrorlist=https://ostree.fedoraproject.org/iot/mirrorlist fedora-iot 'https://ostree.fedoraproject.org/iot'
cp /etc/skel/.bash* /root

mkdir /tmp/myusb
mount /dev/sr0 /tmp/myusb

# Copy files from the installation media to the desired location
cp -r /tmp/myusb/extras /root/

# Unmount the installation media
umount /tmp/myusb

rm -rf /tmp/myusb

 # set the startup script
 mv /root/extras/startup.service /etc/systemd/system/
 mv /root/extras/startup-script.sh /etc/startup-script.sh
 chmod +x /etc/startup-script.sh
 echo "flagFile" > /etc/docker
 echo "flagFile" > /etc/user

  systemctl daemon-reload
  systemctl enable startup.service


%end

# Keyboard layouts
keyboard --vckeymap=us --xlayouts='us'
# System language
lang en_US.UTF-8

# Firewall configuration
firewall --use-system-defaults

# Network configuration
#network --bootproto=static --ip=10.10.175.33 --netmask=255.255.255.0 --gateway=10.10.175.1 --nameserver=8.8.8.8 --device=enp0s3

# OSTree setup
ostreesetup --osname="fedora-iot" --remote="fedora-iot" --url="file:///ostree/repo" --ref="fedora/stable/x86_64/iot" --nogpg

# Run the Setup Agent on first boot
firstboot --enable

# Generated using Blivet version 3.8.1
ignoredisk --only-use=sda
autopart
# Partition clearing information
clearpart --none --initlabel

# System timezone
timezone America/New_York --utc

# Root password
rootpw --iscrypted --allow-ssh $y$j9T$5nuOYuR6ASjCw7lBxiRP87gW$6FsZidk2YXCYh1XAB5Pp5NFSHeMzOAXUvlllCly5lZ4
